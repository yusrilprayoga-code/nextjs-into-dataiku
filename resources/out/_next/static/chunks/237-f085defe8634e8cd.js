(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[237],{1237:(e,t,a)=>{Promise.resolve().then(a.bind(a,6578))},2991:(e,t,a)=>{"use strict";a.d(t,{PI:()=>u,Pz:()=>g,Ww:()=>p,_C:()=>f,my:()=>m,ro:()=>h,zb:()=>x});var s=a(198);let r="uploaded-files",l="well-logs",n="processed-wells",i="well-data-sets",o="saved-plots",c=null,d=()=>c||(c=(0,s.P2)("file-storage-db",5,{upgrade(e,t){t<2&&(e.objectStoreNames.contains(r)||e.createObjectStore(r,{keyPath:"id"}),e.objectStoreNames.contains(l)||e.createObjectStore(l,{keyPath:"id"}).createIndex("by-well","structurePath")),t<3&&!e.objectStoreNames.contains(n)&&e.createObjectStore(n,{keyPath:"wellName"}),t<4&&(e.objectStoreNames.contains(i)||e.createObjectStore(i,{keyPath:["wellName","setName"]}),e.objectStoreNames.contains(o)||e.createObjectStore(o,{keyPath:"id"}).createIndex("by-well","wellName")),t<5&&(e.objectStoreNames.contains(i)&&e.deleteObjectStore(i),e.createObjectStore(i,{keyPath:"setName"}).createIndex("by-well","wells",{multiEntry:!0}))}})),m=async(e,t)=>{let a=await d();await a.put(n,{wellName:e,csvContent:t})},h=async e=>{let t=(await d()).transaction(r,"readwrite");await Promise.all([...e.map(e=>t.store.put(e)),t.done])},u=async e=>{let t=(await d()).transaction(l,"readwrite");await Promise.all([...e.map(e=>t.store.put(e)),t.done]),console.log("Saved ".concat(e.length," individual well logs to IndexedDB."))},x=async()=>(await d()).getAll(l),g=async()=>{let e=await d();return(await e.getAll(r)).sort((e,t)=>e.name.localeCompare(t.name))},p=async e=>{let t=await d();await t.delete(r,e)},f=async()=>{let e=await d();await e.clear(r),await e.clear(l),console.log("All IndexedDB stores have been cleared.")}},6578:(e,t,a)=>{"use strict";a.d(t,{default:()=>E});var s=a(5155),r=a(2115),l=a(9311),n=a.n(l);let i=e=>{if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]},o=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"}),c=e=>new Promise((t,a)=>{let s=new FileReader;s.onload=e=>{var s;(null==(s=e.target)?void 0:s.result)instanceof ArrayBuffer?t(e.target.result):a(Error("Failed to read file as ArrayBuffer."))},s.readAsArrayBuffer(e)}),d=e=>new Promise((t,a)=>{let s=new FileReader;s.onload=e=>{var a;return t(null==(a=e.target)?void 0:a.result)},s.onerror=()=>a(Error("Failed to read file as text.")),s.readAsText(e)});var m=a(408),h=a.n(m);let u=e=>{let t=e.split("\n"),a=[],s=[],r=!1,l=!1;for(let e of t){let t=e.trim();if(t.toUpperCase().startsWith("~C")){r=!0;continue}if(r){if(t.startsWith("~")){r=!1;continue}if(t&&!t.startsWith("#")){let e=t.match(/^([^\s.:]+)/);e&&e[1]&&a.push(e[1])}}}for(let e of t){let t=e.trim();if(t.toUpperCase().startsWith("~A")){l=!0;continue}if(l){if(t.startsWith("~")){l=!1;break}if(t&&!t.startsWith("#")){let e=t.split(/\s+/).filter(e=>""!==e.trim());if(e.length>0){0===a.length&&(a=e.map((e,t)=>"Column ".concat(t+1)));let t={},r=Math.min(a.length,e.length);for(let s=0;s<r;s++)t[a[s]]=e[s];s.push(t)}}}}return{headers:a,data:s}},x=e=>new Promise((t,a)=>{h().parse(e,{header:!0,skipEmptyLines:!0,dynamicTyping:!0,complete:e=>{e.errors.length>0?(console.error("CSV parsing errors:",e.errors),a(Error("CSV error: ".concat(e.errors[0].message," (Row: ").concat(e.errors[0].row,")")))):t({headers:e.meta.fields||[],data:e.data})},error:e=>a(Error("CSV parsing failed: ".concat(e.message)))})});var g=a(9890),p=a(1380),f=a(5761),b=a(2525);let y=e=>{let{file:t,isSelected:a,onSelect:r,onDelete:l}=e,n=g.A;return t.isStructureFromZip?n=p.A:"application/zip"===t.originalFileType&&(n=f.A),(0,s.jsx)("div",{className:"p-3 border-b border-gray-100 cursor-pointer hover:bg-gray-50 transition-colors ".concat(a?"bg-blue-50 border-l-4 border-l-blue-500 font-medium":"border-l-4 border-l-transparent"),onClick:()=>r(t),role:"button",tabIndex:0,onKeyPress:e=>"Enter"===e.key&&r(t),children:(0,s.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-center",children:[(0,s.jsx)("div",{className:"col-span-6",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(n,{className:"w-4 h-4 ".concat(t.isStructureFromZip?"text-yellow-500":"text-gray-400"," flex-shrink-0")}),(0,s.jsx)("span",{className:"text-sm text-gray-700 truncate",title:t.name,children:t.name})]})}),(0,s.jsx)("div",{className:"col-span-3 text-xs text-gray-500",children:o(t.lastModified)}),(0,s.jsx)("div",{className:"col-span-2 text-xs text-gray-500",children:i(t.size)}),(0,s.jsx)("div",{className:"col-span-1 text-right",children:(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),l(t.id)},className:"p-1 hover:bg-red-100 rounded text-red-500 hover:text-red-700 focus:outline-none focus:ring-1 focus:ring-red-500","aria-label":"Delete ".concat(t.name),children:(0,s.jsx)(b.A,{className:"w-4 h-4"})})})]})})};var w=a(7924),v=a(9869);let j=e=>{let{uploadedFiles:t,filteredFiles:a,selectedFile:r,isUploading:l,message:n,searchTerm:i,onSearchTermChange:o,onFileUpload:c,onFileSelect:d,onDeleteFile:m}=e;return(0,s.jsxs)("div",{className:"w-1/3 bg-white border-r border-gray-200 flex flex-col h-full",children:[" ",(0,s.jsxs)("div",{className:"p-4 border-b border-gray-200 bg-gray-100",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("h1",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[(0,s.jsx)(g.A,{className:"w-5 h-5"})," Upload Data"]}),(0,s.jsxs)("span",{className:"text-sm text-gray-500",children:[t.length," item(s)"]})," "]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(w.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,s.jsx)("input",{type:"text",placeholder:"Filter items...",value:i,onChange:e=>o(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),(0,s.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,s.jsxs)("label",{className:"block w-full p-4 border-2 border-dashed rounded-lg cursor-pointer transition-colors ".concat(l?"border-gray-300 bg-gray-50 animate-pulse":"border-blue-300 hover:border-blue-400 hover:bg-blue-50"),children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(v.A,{className:"mx-auto w-8 h-8 text-blue-500 mb-2"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:l?"Processing files...":"Click to upload or drag files here"}),(0,s.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Supports .csv, .las, .xlsx, and .zip (with internal folders for structures)"})]}),(0,s.jsx)("input",{type:"file",multiple:!0,accept:".csv,.las,.xlsx,.zip",onChange:c,disabled:l,className:"hidden","aria-label":"File uploader"})]}),n&&(0,s.jsx)("div",{className:"mt-2 p-2 border rounded text-sm ".concat(n.startsWith("Error")?"bg-red-50 border-red-200 text-red-700":n.startsWith("Warning")?"bg-yellow-50 border-yellow-200 text-yellow-700":"bg-blue-50 border-blue-200 text-blue-700"),role:"alert",children:n})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[(0,s.jsx)("div",{className:"px-4 py-2 bg-gray-50 border-b border-gray-200 sticky top-0 z-10",children:(0,s.jsxs)("div",{className:"grid grid-cols-12 gap-2 text-xs font-medium text-gray-500 uppercase",children:[(0,s.jsx)("div",{className:"col-span-6",children:"Name"}),(0,s.jsx)("div",{className:"col-span-3",children:"Modified"}),(0,s.jsx)("div",{className:"col-span-2",children:"Size"}),(0,s.jsx)("div",{className:"col-span-1 text-right",children:"Del"})]})}),a.map(e=>(0,s.jsx)(y,{file:e,isSelected:(null==r?void 0:r.id)===e.id,onSelect:d,onDelete:m},e.id)),t.length>0&&0===a.length&&(0,s.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,s.jsx)(w.A,{className:"mx-auto w-12 h-12 text-gray-300 mb-3"}),(0,s.jsx)("p",{children:"No items match your search."})]}),0===t.length&&(0,s.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,s.jsx)(g.A,{className:"mx-auto w-12 h-12 text-gray-300 mb-3"}),(0,s.jsx)("p",{children:"No items uploaded"}),(0,s.jsx)("p",{className:"text-sm",children:"Upload files or ZIP archives with structures to get started"})]})]})]})};var N=a(2657),S=a(7434);let F=e=>{let{headers:t,content:a}=e;return t&&0!==t.length&&a&&0!==a.length?(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50 sticky top-0 z-10",children:(0,s.jsx)("tr",{children:t.map((e,t)=>(0,s.jsx)("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200 whitespace-nowrap",title:e,children:e},t))})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:a.slice(0,1e3).map((e,a)=>(0,s.jsx)("tr",{className:"".concat(a%2==0?"bg-white":"bg-gray-50"," hover:bg-gray-100"),children:t.map((t,a)=>{var r,l;return(0,s.jsx)("td",{className:"px-4 py-3 text-sm text-gray-700 whitespace-nowrap max-w-xs truncate",title:String(null!=(r=e[t])?r:""),children:String(null!=(l=e[t])?l:"")},a)})},a))})]}):(0,s.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,s.jsx)(g.A,{className:"mx-auto w-12 h-12 text-gray-300 mb-3"}),(0,s.jsx)("p",{children:"No data or headers to display for this selection."})]})},C=e=>{var t,a,r,l,n;let{selectedFile:o,selectedSubFile:c,onSelectSubFile:d}=e;if(!o)return(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center bg-white",children:(0,s.jsxs)("div",{className:"text-center text-gray-500 p-5",children:[(0,s.jsx)(N.A,{className:"mx-auto w-16 h-16 text-gray-300 mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Select an item to preview"}),(0,s.jsx)("p",{children:"Choose an item from the list on the left."})]})});let m=o.name,h="";return o.isStructureFromZip?(h="Structure (from ".concat(o.originalZipName||"ZIP","). Contains: ").concat((null==(t=o.lasFiles)?void 0:t.length)||0," LAS, ").concat((null==(a=o.csvFiles)?void 0:a.length)||0," CSV."),c&&(m="".concat(o.name," / ").concat(c.name),h="Previewing ".concat(c.type.toUpperCase()," file. ").concat(c.content.length," rows \xd7 ").concat(c.headers.length," columns."))):h="Previewing ".concat(Math.min((null==(r=o.content)?void 0:r.length)||0,1e3)," of ").concat((null==(l=o.content)?void 0:l.length)||0," rows \xd7 ").concat((null==(n=o.headers)?void 0:n.length)||0," columns"),(0,s.jsxs)("div",{className:"flex-1 flex flex-col bg-white",children:[(0,s.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[(0,s.jsx)(N.A,{className:"w-5 h-5 text-blue-500 flex-shrink-0"}),(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("h2",{className:"font-semibold text-gray-800 truncate",title:m,children:m}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:h})]})]}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)("span",{className:"text-sm text-gray-500 flex-shrink-0",children:i(o.size)})})]})}),(0,s.jsx)("div",{className:"flex-1 overflow-auto",children:o.isStructureFromZip?(0,s.jsx)(s.Fragment,{children:c?(0,s.jsx)(F,{headers:c.headers,content:c.content}):(0,s.jsxs)("div",{className:"p-4",children:[o.lasFiles&&o.lasFiles.length>0&&(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h3",{className:"text-md font-semibold text-gray-700 mb-2",children:"LAS Files:"}),(0,s.jsx)("ul",{className:"space-y-1",children:o.lasFiles.map(e=>(0,s.jsxs)("li",{className:"text-sm text-blue-600 hover:underline cursor-pointer p-1 rounded hover:bg-gray-100 flex items-center gap-2",onClick:()=>d(e),children:[(0,s.jsx)(S.A,{className:"w-4 h-4 text-gray-500 flex-shrink-0"})," ",e.name]},e.id))})]}),o.csvFiles&&o.csvFiles.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-md font-semibold text-gray-700 mb-2",children:"CSV Files (Markers):"}),(0,s.jsx)("ul",{className:"space-y-1",children:o.csvFiles.map(e=>(0,s.jsxs)("li",{className:"text-sm text-blue-600 hover:underline cursor-pointer p-1 rounded hover:bg-gray-100 flex items-center gap-2",onClick:()=>d(e),children:[(0,s.jsx)(S.A,{className:"w-4 h-4 text-gray-500 flex-shrink-0"})," ",e.name]},e.id))})]}),(!o.lasFiles||0===o.lasFiles.length)&&(!o.csvFiles||0===o.csvFiles.length)&&(0,s.jsx)("p",{className:"text-gray-500",children:"No LAS or CSV files found in this structure."})]})}):o.content&&o.headers?(0,s.jsx)(F,{headers:o.headers,content:o.content}):(0,s.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,s.jsx)(g.A,{className:"mx-auto w-12 h-12 text-gray-300 mb-3"}),(0,s.jsx)("p",{children:"No data to display for this file."})]})})]})};var P=a(5695),A=a(4616),k=a(2991);function E(){let[e,t]=(0,r.useState)([]),[a,l]=(0,r.useState)(null),[i,o]=(0,r.useState)(null),[m,h]=(0,r.useState)(!1),[g,p]=(0,r.useState)(""),[f,b]=(0,r.useState)(""),[y,w]=(0,r.useState)(!1),[v,N]=(0,r.useState)(!1),S=(0,P.useRouter)();(0,r.useEffect)(()=>{(async()=>{p("Loading saved files...");try{let e=await (0,k.Pz)();t(e)}catch(e){console.error("Failed to load files from database:",e),p("Error: Could not load saved files.")}finally{p(""),w(!0)}})()},[]);let F=async(e,t)=>{let a=await n().loadAsync(t),s=new Map,r=[];a.forEach((e,t)=>{if(t.dir)return;let a=e.split("/"),l=a.length>1?a[0]:"_ROOT_FILES_IN_ZIP_",n=a.length>1?a.slice(1).join("/"):e;s.has(l)||s.set(l,{lasFiles:[],csvFiles:[]});let i=s.get(l),o="".concat(l,"_").concat(n,"_").concat(Date.now(),"_").concat(Math.random().toString(36).substring(2,7));if(n.toLowerCase().endsWith(".las")){let a=t.async("string").then(e=>{let t=u(e);i.lasFiles.push({id:o,name:n,type:"las",rawContentString:e,content:t.data,headers:t.headers})}).catch(t=>console.error("Failed to process LAS ".concat(e,":"),t));r.push(a)}else if(n.toLowerCase().endsWith(".csv")){let a=t.async("string").then(async e=>{let t=await x(e);i.csvFiles.push({id:o,name:n,type:"csv",rawContentString:e,content:t.data,headers:t.headers})}).catch(t=>console.error("Failed to process CSV ".concat(e,":"),t));r.push(a)}}),await Promise.all(r);let l=[];for(let[t,a]of s.entries())(a.lasFiles.length>0||a.csvFiles.length>0)&&l.push({id:"".concat(e.name,"_").concat(t,"_").concat(Date.now(),"_").concat(Math.random().toString(36).substring(2,7)),name:"_ROOT_FILES_IN_ZIP_"===t?"".concat(e.name," (Root Files)"):t,originalZipName:e.name,size:e.size,originalFileType:e.type,lastModified:e.lastModified,isStructureFromZip:!0,lasFiles:a.lasFiles.sort((e,t)=>e.name.localeCompare(t.name)),csvFiles:a.csvFiles.sort((e,t)=>e.name.localeCompare(t.name)),content:[],headers:[]});return l.sort((e,t)=>e.name.localeCompare(t.name)),l},E=async e=>{await (0,k._C)(),N(!1);let a=e.target.files;if(!a||0===a.length)return;h(!0),p("Processing files...");let s=[];for(let e of Array.from(a))try{if(e.name.toLowerCase().endsWith(".zip")){let t=await c(e),a=await F(e,t);a.length>0&&s.push(...a)}else{let t,a=await d(e),r=e.name.replace(/\.[^/.]+$/,""),l=null;if(e.name.toLowerCase().endsWith(".las"))t=u(a),l="las-as-csv";else{if(!e.name.toLowerCase().endsWith(".csv"))continue;t=await x(a),l="csv"}s.push({id:e.name,name:e.name,size:e.size,originalFileType:e.type,lastModified:e.lastModified,isStructureFromZip:!1,content:t.data.slice(0,1e3),headers:t.headers,rawFileContent:a}),(await (0,k.zb)()).push({id:e.name,name:e.name,originalName:e.name,structurePath:r,type:l,content:t.data,headers:t.headers,rawContentString:a})}}catch(t){console.error("Error processing ".concat(e.name,":"),t),p("Error processing ".concat(e.name,": ").concat(t instanceof Error?t.message:"Unknown error"))}let r=[];if(s.forEach(e=>{if(e.isStructureFromZip){let t=(t,a)=>{null==t||t.forEach(t=>{r.push({id:t.id,name:"".concat(e.name,"/").concat(t.name),originalName:t.name,structurePath:e.name,type:a,content:t.content,headers:t.headers,rawContentString:t.rawContentString})})};t(e.lasFiles,"las-as-csv"),t(e.csvFiles,"csv")}}),s.length>0)try{p("Saving data to browser database..."),await (0,k.ro)(s),await (0,k.PI)(r),console.log("SUCCESS: Data has been saved to IndexedDB."),p("Successfully processed and saved ".concat(r.length," log(s). You may now proceed.")),N(!0);let e=await (0,k.Pz)();t(e)}catch(e){console.error("Error occurred when trying to save everything to database",e),p("Error: Could not save data to the database.")}else p("No new files or structures were processed.");h(!1),setTimeout(()=>{g.startsWith("Error")||p("")},5e3),e.target&&(e.target.value="")},_=async e=>{try{await (0,k.Ww)(e),(null==a?void 0:a.id)===e&&l(null);let s=await (0,k.Pz)();t(s)}catch(e){console.error("Failed to delete file from database:",e),p("Error: Could not delete the file.")}};return(0,s.jsxs)("div",{className:"flex h-[calc(100vh-80px)] bg-gray-50",children:[(0,s.jsx)(j,{uploadedFiles:e,filteredFiles:e.filter(e=>e.name.toLowerCase().includes(f.toLowerCase())),selectedFile:a,isUploading:m||!y,message:g,searchTerm:f,onSearchTermChange:b,onFileUpload:E,onFileSelect:l,onDeleteFile:_}),(0,s.jsx)(C,{selectedFile:a,selectedSubFile:i,onSelectSubFile:o}),e.length>0&&(0,s.jsx)("div",{className:"fixed bottom-8 right-8 z-50",children:(0,s.jsx)("button",{onClick:()=>{let e=window.prompt("Please enter a name for this data structure/folder:");if(!e||!e.trim())return void p("Structure name is required.");let t=e.trim();S.push("/data-input?structureName=".concat(encodeURIComponent(t)))},title:v?"Proceed with saved data":"Please upload and process files first",disabled:!v,className:"p-4 rounded-full shadow-xl flex items-center justify-center transition-all duration-150 ease-in-out\n            ".concat(v?"bg-green-500 hover:bg-green-600 transform hover:scale-110":"bg-gray-400 cursor-not-allowed","\n          "),"aria-label":"Proceed with uploaded files",children:(0,s.jsx)(A.A,{size:28,className:"text-white"})})})]})}}}]);