(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[114],{1154:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(9946).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},2991:(e,t,a)=>{"use strict";a.d(t,{PI:()=>h,Pz:()=>g,Ww:()=>p,_C:()=>b,my:()=>m,ro:()=>u,zb:()=>x});var s=a(198);let l="uploaded-files",r="well-logs",n="processed-wells",c="well-data-sets",i="saved-plots",o=null,d=()=>o||(o=(0,s.P2)("file-storage-db",5,{upgrade(e,t){t<2&&(e.objectStoreNames.contains(l)||e.createObjectStore(l,{keyPath:"id"}),e.objectStoreNames.contains(r)||e.createObjectStore(r,{keyPath:"id"}).createIndex("by-well","structurePath")),t<3&&!e.objectStoreNames.contains(n)&&e.createObjectStore(n,{keyPath:"wellName"}),t<4&&(e.objectStoreNames.contains(c)||e.createObjectStore(c,{keyPath:["wellName","setName"]}),e.objectStoreNames.contains(i)||e.createObjectStore(i,{keyPath:"id"}).createIndex("by-well","wellName")),t<5&&(e.objectStoreNames.contains(c)&&e.deleteObjectStore(c),e.createObjectStore(c,{keyPath:"setName"}).createIndex("by-well","wells",{multiEntry:!0}))}})),m=async(e,t)=>{let a=await d();await a.put(n,{wellName:e,csvContent:t})},u=async e=>{let t=(await d()).transaction(l,"readwrite");await Promise.all([...e.map(e=>t.store.put(e)),t.done])},h=async e=>{let t=(await d()).transaction(r,"readwrite");await Promise.all([...e.map(e=>t.store.put(e)),t.done]),console.log("Saved ".concat(e.length," individual well logs to IndexedDB."))},x=async()=>(await d()).getAll(r),g=async()=>{let e=await d();return(await e.getAll(l)).sort((e,t)=>e.name.localeCompare(t.name))},p=async e=>{let t=await d();await t.delete(l,e)},b=async()=>{let e=await d();await e.clear(l),await e.clear(r),console.log("All IndexedDB stores have been cleared.")}},4828:(e,t,a)=>{Promise.resolve().then(a.bind(a,6572))},6572:(e,t,a)=>{"use strict";a.d(t,{default:()=>w});var s=a(5155),l=a(2115),r=a(5695),n=a(408),c=a.n(n),i=a(8335),o=a(1154),d=a(9946);let m=(0,d.A)("inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]);var u=a(1380),h=a(7434);let x=(0,d.A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var g=a(2657);let p=e=>{let{file:t}=e;if(!t||!t.content||0===t.content.length)return(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center p-8",children:(0,s.jsxs)("div",{className:"text-center text-gray-400",children:[(0,s.jsx)(g.A,{className:"mx-auto w-16 h-16 mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-medium",children:"No File Selected"}),(0,s.jsx)("p",{children:"Select a file from the list to preview its contents."})]})});let a=t.headers||(t.content.length>0?Object.keys(t.content[0]):[]);return 0===a.length?(0,s.jsx)("div",{className:"p-4",children:"No data or headers to display."}):(0,s.jsxs)("div",{className:"flex-1 overflow-auto",children:[(0,s.jsxs)("table",{className:"min-w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-100 sticky top-0 z-10",children:(0,s.jsx)("tr",{children:a.map((e,t)=>(0,s.jsx)("th",{className:"px-4 py-2 text-left font-semibold text-gray-600 border-b border-gray-200 whitespace-nowrap",children:e},t))})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.content.slice(0,1e3).map((e,t)=>(0,s.jsx)("tr",{className:"hover:bg-gray-50",children:a.map((t,a)=>{var l,r;return(0,s.jsx)("td",{className:"px-4 py-2 text-gray-700 whitespace-nowrap max-w-xs truncate",title:String(null!=(l=e[t])?l:""),children:String(null!=(r=e[t])?r:"")},a)})},t))})]}),t.content.length>1e3&&(0,s.jsxs)("div",{className:"p-4 text-center text-sm text-gray-500 border-t",children:["Showing first 1000 of ",t.content.length," rows."]})]})};var b=a(2991),y=a(9509);let f=e=>{switch(e){case"MISSING_LOGS":case"ERROR":return"bg-red-100 hover:bg-red-200";case"HAS_NULL":return"bg-yellow-100 hover:bg-yellow-200";case"EXTREME_VALUES":return"bg-orange-100 hover:bg-orange-200";case"PASS":return"hover:bg-green-50";default:return"hover:bg-gray-50"}},N=e=>{switch(e){case"MISSING_LOGS":return"bg-red-100 text-red-800";case"HAS_NULL":return"bg-yellow-100 text-yellow-800";case"EXTREME_VALUES":return"bg-orange-100 text-orange-800";case"PASS":return"bg-green-100 text-green-800";case"ERROR":return"bg-red-200 text-red-900 font-bold";default:return"bg-gray-100 text-gray-800"}};function w(){let e=(0,r.useRouter)(),t=(0,r.useSearchParams)(),[a,n]=(0,l.useState)(!0),{stagedStructure:d,setStagedStructure:g,qcResults:w,setQcResults:j,handledFiles:v,addHandledFile:S,clearAllData:_,clearQcResults:k}=(0,i.m)(),[P,I]=(0,l.useState)(!1),[C,L]=(0,l.useState)("input"),[R,A]=(0,l.useState)(null),[D,E]=(0,l.useState)(null),[O,z]=(0,l.useState)(!1),[F,U]=(0,l.useState)(""),[T,q]=(0,l.useState)({});(0,l.useEffect)(()=>{(async()=>{if(console.log("--- DATA INITIALIZATION START ---"),i.m.getState().stagedStructure){console.log("Data already exists in store. Skipping fetch, proceeding to render."),n(!1);return}try{let e=t.get("structureName");if(console.log("[LOG 1] Structure Name from URL:",e),!e)throw Error("No structure name found in URL. Cannot initialize page.");let a=await (0,b.zb)();if(0===a.length)throw Error("No well logs found in IndexedDB.");console.log("[LOG 2 & 3] Retrieved and transformed data:",a);let s={userDefinedStructureName:e,files:a};g(s),console.log("[LOG 4] Final object to be set in state:",s)}catch(t){console.error("Initialization failed, redirecting to home:",t),e.replace("/")}finally{n(!1)}})()},[e,t,g]);let W=async()=>{if(d){z(!0),U("Langkah 1: Menjalankan Quality Control..."),j(null),L("output"),E(null),A(null);try{let e=d.files.map(e=>({name:e.originalName||e.name,content:e.rawContentString})),t=y.env.NEXT_PUBLIC_API_URL,a="".concat(t,"/api/run-qc");console.log("Sending QC request to: ".concat(a));let s=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({files:e})});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.details||"Initial QC failed")}let l=await s.json();j(l),q(l.output_files||{})}catch(e){alert("Error saat QC: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{z(!1),U("")}}},G=()=>{I(!0),e.push("/dashboard")},M=e=>{A(e.id),E({id:e.id,name:e.name,content:e.content,headers:e.headers})},Q=e=>{A(e.id),E(e)},B=e=>{if(!w)return;A(e.well_name);let t=Object.keys(w.output_files).find(t=>t.startsWith(e.well_name));t&&w.output_files[t]?c().parse(w.output_files[t],{header:!0,skipEmptyLines:!0,complete:a=>E({id:e.well_name,name:t,content:a.data,headers:a.meta.fields||[]})}):E({id:e.well_name,name:"".concat(e.well_name," (No file content)"),content:[],headers:["Info"]})};return a?(0,s.jsxs)("div",{className:"h-screen w-screen flex items-center justify-center bg-gray-50",children:[(0,s.jsx)(o.A,{className:"w-8 h-8 animate-spin text-gray-500"}),(0,s.jsx)("p",{className:"ml-4",children:"Loading session data..."})]}):d?(0,s.jsxs)("div",{className:"flex h-[calc(100vh-80px)] bg-gray-50 text-gray-800",children:[(0,s.jsxs)("div",{className:"w-64 flex-shrink-0 bg-white border-r border-gray-200 flex flex-col p-4",children:[(0,s.jsx)("h1",{className:"text-xl font-bold mb-6",children:"Data Input Utama"}),(0,s.jsxs)("nav",{className:"space-y-2",children:[(0,s.jsxs)("button",{onClick:()=>{L("input"),E(null),A(null)},className:"w-full flex items-center gap-3 p-2 rounded-md text-sm font-medium transition-colors ".concat("input"===C?"bg-blue-100 text-blue-700":"hover:bg-gray-100"),children:[(0,s.jsx)(m,{className:"w-5 h-5"})," ",d.userDefinedStructureName," (Input)"]}),(0,s.jsxs)("button",{onClick:()=>{L("output"),E(null),A(null)},disabled:!w,className:"w-full flex items-center gap-3 p-2 rounded-md text-sm font-medium transition-colors ".concat("output"===C?"bg-blue-100 text-blue-700":"hover:bg-gray-100"," disabled:text-gray-400 disabled:cursor-not-allowed"),children:[(0,s.jsx)(u.A,{className:"w-5 h-5"})," Output"]})]}),(0,s.jsxs)("div",{className:"mt-auto pt-4 space-y-2 border-t",children:[(0,s.jsx)("button",{onClick:W,disabled:O||P,className:"w-full px-4 py-3 bg-green-500 text-white font-bold rounded hover:bg-green-600 disabled:bg-gray-400 flex items-center justify-center gap-2",children:O?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.A,{className:"w-5 h-5 animate-spin"}),"Processing..."]}):"Run Quality Control"}),(0,s.jsx)("button",{onClick:()=>{G()},disabled:P||P,className:"w-full px-4 py-2 bg-blue-500 text-white font-bold rounded hover:bg-blue-600 flex items-center justify-center transition-colors disabled:bg-gray-400 disabled:cursor-wait",children:P?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.A,{className:"mr-2 h-5 w-5 animate-spin"}),"Loading..."]}):"Continue"}),(0,s.jsx)("button",{onClick:()=>{_(),e.push("/")},className:"w-full px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:"Start New Session"})]})]}),(0,s.jsxs)("div",{className:"flex-1 bg-gray-100 border-r border-gray-200 flex flex-col",children:[(0,s.jsxs)("div",{className:"p-4 border-b font-semibold text-lg bg-white",children:["input"===C&&'Files in "'.concat(d.userDefinedStructureName,'"'),"output"===C&&"Initial QC Results","handled"===C&&"Handled Files (ABB pass_qc)"]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto",children:["input"===C&&(0,s.jsxs)("table",{className:"min-w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-200 sticky top-0",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-2 text-left font-semibold text-gray-600",children:"File Name"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left font-semibold text-gray-600",children:"Original Type"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:d.files.map(e=>(0,s.jsxs)("tr",{onClick:()=>M(e),className:"cursor-pointer hover:bg-blue-50 ".concat(R===e.id?"bg-blue-100":""),children:[(0,s.jsxs)("td",{className:"px-4 py-2 flex items-center gap-2 text-black",children:[(0,s.jsx)(h.A,{className:"w-4 h-4 text-gray-400"}),e.name]}),(0,s.jsx)("td",{className:"px-4 py-2 text-black",children:e.type})]},e.id))})]}),"output"===C&&w&&(0,s.jsxs)("table",{className:"min-w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-200 sticky top-0",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-2 text-left font-semibold text-gray-600",children:"Well Name"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left font-semibold text-gray-600",children:"Status"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left font-semibold text-gray-600",children:"Details"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-gray-200 bg-white",children:w.qc_summary.map(e=>(0,s.jsxs)("tr",{onClick:()=>B(e),className:"cursor-pointer transition-colors ".concat(f(e.status)," ").concat(R===e.well_name?"border-l-4 border-blue-500":""),children:[(0,s.jsx)("td",{className:"px-4 py-2 font-medium text-black",children:e.well_name}),(0,s.jsx)("td",{className:"px-4 py-2",children:(0,s.jsx)("span",{className:"px-2 py-0.5 text-xs font-semibold rounded-full ".concat(N(e.status)),children:e.status})}),(0,s.jsx)("td",{className:"px-4 py-2 text-black",children:e.details})]},e.well_name))})]}),"handled"===C&&(0,s.jsxs)("table",{className:"min-w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-200 sticky top-0",children:(0,s.jsx)("tr",{children:(0,s.jsx)("th",{className:"px-4 py-2 text-left font-semibold text-gray-600",children:"Handled File Name"})})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:v.length>0?v.map(e=>(0,s.jsx)("tr",{onClick:()=>Q(e),className:"cursor-pointer hover:bg-blue-50 ".concat(R===e.id?"bg-blue-100":""),children:(0,s.jsxs)("td",{className:"px-4 py-2 flex items-center gap-2 text-black",children:[(0,s.jsx)(x,{className:"w-4 h-4 text-green-500"}),e.name]})},e.id)):(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:1,className:"p-4 text-center text-gray-500",children:"No files have been processed for null values yet."})})})]})]})]}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col bg-white",children:[(0,s.jsxs)("div",{className:"p-4 border-b",children:[(0,s.jsx)("h2",{className:"font-semibold text-lg",children:"File Preview"}),(0,s.jsx)("p",{className:"text-sm text-gray-500 truncate",children:D?D.name:"No file selected"})]}),(0,s.jsx)(p,{file:D})]})]}):(0,s.jsx)("div",{className:"h-screen w-screen flex items-center justify-center bg-gray-50",children:(0,s.jsx)("p",{children:"No data found. Redirecting..."})})}},8335:(e,t,a)=>{"use strict";a.d(t,{m:()=>r});var s=a(5453),l=a(6786);let r=(0,s.v)()((0,l.Zr)((e,t)=>({stagedStructure:null,qcResults:null,handledFiles:[],normalizationResults:{},selectedWell:"",selectedIntervals:[],plotData:[],plotLayout:{},isLoadingPlot:!0,plotError:null,vshParams:{gr_ma:30,gr_sh:120},vshDNParams:{rhob_ma:2.645,rhob_sh:2.61,nphi_ma:-.02,nphi_sh:.398,prcnt_qz:5,prcnt_wtr:5},wellsDir:"data/structures/adera/benuang",fieldName:"adera",structureName:"benuang",wellFolder:"BNG-057",setWellsDir:t=>{console.log("Updating wellsDir to: ".concat(t)),e({wellsDir:t})},setStructure:(t,a,s)=>{let l="data/structures/".concat(t.toLowerCase(),"/").concat(a.toLowerCase());console.log("Updating structure settings:\n          fieldName: ".concat(t.toLowerCase(),"\n          structureName: ").concat(a.toLowerCase(),"\n          wellFolder: ").concat(s.toLowerCase(),"\n          wellsDir: ").concat(l)),e({fieldName:t.toLowerCase(),structureName:a.toLowerCase(),wellFolder:s.toLowerCase(),wellsDir:l})},setStagedStructure:t=>e({stagedStructure:t}),setQcResults:t=>e({qcResults:t}),addHandledFile:t=>e(e=>({handledFiles:[...e.handledFiles,t]})),addNormalizationResult:(t,a)=>e(e=>({normalizationResults:{...e.normalizationResults,[t]:a}})),clearQcResults:()=>e({qcResults:null,handledFiles:[]}),clearNormalizationResults:()=>e({normalizationResults:{}}),clearAllData:()=>e({stagedStructure:null,qcResults:null,handledFiles:[],normalizationResults:{},vshParams:{gr_ma:30,gr_sh:120},vshDNParams:{rhob_ma:2.645,rhob_sh:2.61,nphi_ma:-.02,nphi_sh:.398,prcnt_qz:5,prcnt_wtr:5}}),setSelectedWell:a=>{e({selectedWell:a}),t().fetchPlotData(a)},toggleInterval:t=>e(e=>({selectedIntervals:e.selectedIntervals.includes(t)?e.selectedIntervals.filter(e=>e!==t):[...e.selectedIntervals,t]})),setVshParams:t=>e({vshParams:t}),setVshDNParams:t=>e({vshDNParams:t}),fetchPlotData:async e=>{}}),{name:"app-data-storage",partialize:e=>({selectedWell:e.selectedWell,selectedIntervals:e.selectedIntervals,vshParams:e.vshParams,vshDNParams:e.vshDNParams}),storage:(0,l.KU)(()=>localStorage)}))}},e=>{var t=t=>e(e.s=t);e.O(0,[9,119,441,684,358],()=>t(4828)),_N_E=e.O()}]);