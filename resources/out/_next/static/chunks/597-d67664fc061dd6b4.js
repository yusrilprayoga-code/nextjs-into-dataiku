"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[597],{2577:(e,t,a)=>{a.d(t,{M:()=>d,q:()=>c});var l=a(5155),s=a(8335),r=a(5695),n=a(2115),o=a(9509);let i=(0,n.createContext)(void 0),c=e=>{let{children:t}=e,[a,c]=(0,n.useState)([]),[d,m]=(0,n.useState)([]),[u,h]=(0,n.useState)([]),[p,g]=(0,n.useState)([]),[b,f]=(0,n.useState)([]),[x,y]=(0,n.useState)([]),[w,N]=(0,n.useState)({}),[j,v]=(0,n.useState)([]),[_,E]=(0,n.useState)("default"),[S,P]=(0,n.useState)(null),[R,C]=(0,n.useState)({data:[],layout:{}}),[k,L]=(0,n.useState)(!1),[T,O]=(0,n.useState)(null),[I,A]=(0,n.useState)(null),U=o.env.NEXT_PUBLIC_API_URL,D=(0,r.usePathname)().startsWith("/data-prep"),{wellsDir:M}=(0,s.m)(),H=(0,n.useRef)(new Set),B=(0,n.useRef)(new Set);(0,n.useEffect)(()=>{(async()=>{if(D||!M){c([]),m([]),h([]);return}try{if(!U)throw Error("API URL is not configured.");let e=await fetch("".concat(U,"/api/list-wells"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({full_path:M})});if(!e.ok)throw Error("Failed to fetch well list");let t=await e.json();Array.isArray(t)&&c(t)}catch(e){console.error("Failed to fetch well list:",e)}try{let e=await fetch("".concat(U,"/api/list-intervals"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({full_path:M})});if(e.ok){let t=await e.json();Array.isArray(t)&&m(t)}}catch(e){console.error("Error fetching intervals:",e)}try{let e=await fetch("".concat(U,"/api/list-zones"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({full_path:M})});if(!e.ok)throw Error("Failed to fetch zone list");let t=await e.json();Array.isArray(t)&&h(t)}catch(e){console.error("Error fetching zones:",e)}})()},[U,D,M]);let F=(0,n.useCallback)(async e=>{let t;if(!U)return void console.warn("API URL not set, cannot fetch well columns");let a=e.filter(e=>!H.current.has(e)&&!B.current.has(e));if(0!==a.length){if(D)t={wells:a};else{if(!M)return void console.warn("wellsDir is not set; cannot fetch columns for dashboard.");t={full_path:M,wells:a}}a.forEach(e=>B.current.add(e)),A(null);try{let e=await fetch("".concat(U,"/api/get-well-columns"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw Error("Server responded with status: ".concat(e.status));let l=await e.json();if("object"!=typeof l||null===l||0===Object.keys(l).length)throw Error("API returned empty or invalid data for well columns.");N(e=>({...e,...l})),a.forEach(e=>{H.current.add(e),B.current.delete(e)})}catch(t){a.forEach(e=>B.current.delete(e));let e=t instanceof Error?t.message:"An unknown error occurred";A("Failed to load curves: ".concat(e)),console.error("Failed to fetch well columns:",t)}}},[U,D,M]);(0,n.useEffect)(()=>{if(0===p.length){N({}),A(null),H.current.clear(),B.current.clear();return}F(p)},[p,F]);let W=(0,n.useCallback)(async()=>{let e;L(!0),O(null),C({data:[],layout:{}});let t=!!S;if(!t&&0===p.length){C({data:[],layout:{title:{text:"Please select a well from the list."}}}),L(!1);return}if(t&&!S){C({data:[],layout:{title:{text:"Please select a file from the browser."}}}),L(!1);return}let a="";if(t){switch(_){case"normalization-prep":a="/api/get-normalization-prep-plot";break;case"smoothing-prep":a="/api/get-smoothing-prep-plot";break;case"splicing":a="/api/get-splicing-plot";break;case"custom":a="/api/get-custom-plot";break;default:a="/api/get-module1-plot"}e="custom"===_?{custom_columns:j,file_path:S}:{file_path:S}}else{switch(_){case"normalization":a="/api/get-normalization-plot";break;case"smoothing":a="/api/get-smoothing-plot";break;case"splicing":a="/api/get-splicing-plot";break;case"porosity":a="/api/get-porosity-plot";break;case"gsa":a="/api/get-gsa-plot";break;case"vsh":a="/api/get-vsh-plot";break;case"sw":a="/api/get-sw-plot";break;case"rwa":a="/api/get-rwa-plot";break;case"module2":a="/api/get-module2-plot";break;case"rpbe-rgbe":a="/api/get-rgbe-rpbe-plot";break;case"iqual":a="/api/get-iqual";break;case"swgrad":a="/api/get-swgrad-plot";break;case"dns-dnsv":a="/api/get-dns-dnsv-plot";break;case"rt-ro":a="/api/get-rt-r0-plot";break;case"module3":a="/api/get-module3-plot";break;case"custom":a="/api/get-custom-plot";break;default:a="/api/get-plot"}e="custom"===_?{custom_columns:j,selected_wells:p,selected_intervals:b,selected_zones:x,full_path:M}:{selected_wells:p,selected_intervals:b,selected_zones:x,full_path:M}}try{let t=await fetch("".concat(U).concat(a),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json()).error||"Failed to fetch plot from server");let l=await t.json(),s="string"==typeof l?JSON.parse(l):l;if(s&&(s.data||s.layout))C({data:s.data||[],layout:s.layout||{}});else throw Error("Invalid plot data structure received from server.")}catch(e){console.error('Error fetching plot for type "'.concat(_,'":'),e),O(e instanceof Error?e.message:"An unknown error occurred")}finally{L(!1)}},[U,_,S,p,b,x,j,M,D]);return(0,l.jsx)(i.Provider,{value:{availableWells:a,selectedWells:p,toggleWellSelection:e=>{g(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},availableIntervals:d,selectedIntervals:b,toggleInterval:e=>{f(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},availableZones:u,selectedZones:x,toggleZone:e=>{y(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},wellColumns:w,plotType:_,setPlotType:E,plotFigure:R,setPlotFigure:C,selectedFilePath:S,setSelectedFilePath:P,fetchWellColumns:F,isLoadingPlot:k,plotError:T,fetchPlotData:W,selectedCustomColumns:j,toggleCustomColumn:e=>{v(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},columnError:I},children:t})},d=()=>{let e=(0,n.useContext)(i);if(void 0===e)throw Error("useDashboard must be used within a DashboardProvider");return e}},3483:(e,t,a)=>{a.d(t,{A:()=>m});var l=a(5155),s=a(2115),r=a(5695),n=a(2577),o=a(1154),i=a(8335),c=a(9509);let d=()=>{let e=e=>({default:e}),t={TRIM_MODE:"CUSTOM_TRIM",DEPTH_ABOVE:"",DEPTH_BELOW:""};return[{id:1,location:"Parameter",mode:"Input",comment:"Pilih mode trim",unit:"MODE",name:"TRIM_MODE",isEnabled:!0},{id:2,location:"Parameter",mode:"Input",comment:"Trim data di atas kedalaman ini",unit:"m",name:"DEPTH_ABOVE",isEnabled:!0},{id:3,location:"Parameter",mode:"Input",comment:"Trim data di bawah kedalaman ini",unit:"m",name:"DEPTH_BELOW",isEnabled:!0}].map(a=>({...a,values:e(t[a.name]||"")}))};function m(){var e;let{selectedWells:t,selectedIntervals:a,selectedFilePath:m}=(0,n.M)(),u=(0,r.useRouter)(),h=(0,r.usePathname)(),[p,g]=(0,s.useState)(d()),[b,f]=(0,s.useState)(!1),{wellsDir:x}=(0,i.m)(),y=(null==h?void 0:h.startsWith("/data-prep"))||!1,w=(e,t)=>{g(a=>a.map(a=>a.id===e?{...a,values:{default:t}}:a))},N=async e=>{let l;e.preventDefault(),f(!0);let s=p.filter(e=>e.isEnabled).reduce((e,t)=>(e[t.name]=t.values.default,e),{});if(y){if(!m){alert("Please select a file from the Wells Browser sidebar first."),f(!1);return}l={params:s,file_paths:[m],selected_wells:t,selected_intervals:[]}}else l={params:s,full_path:x,selected_wells:t,selected_intervals:a};let r=c.env.NEXT_PUBLIC_API_URL;try{let e=await fetch("".concat(r,"/api/trim-data"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!e.ok){let t=await e.json();throw Error(t.error||"Server error")}let t=await e.json();alert(t.message||"Data berhasil di-trim."),u.push(y?"/data-prep":"/dashboard")}catch(e){alert("Error: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{f(!1)}},j=(e,t)=>{switch(e){case"Parameter":return"bg-orange-600 text-white";case"Constant":return"Input"===t?"bg-yellow-300":"bg-yellow-100";case"Log":return"Input"===t?"bg-cyan-400":"bg-cyan-200";default:return"bg-white"}},v=null==(e=p.find(e=>"TRIM_MODE"===e.name))?void 0:e.values.default;return(0,l.jsxs)("div",{className:"p-4 md:p-6 h-full flex flex-col bg-white rounded-lg shadow-md",children:[(0,l.jsx)("h2",{className:"text-xl font-bold mb-4 text-gray-800 flex-shrink-0",children:"Trim Well Log Data"}),(0,l.jsxs)("form",{onSubmit:N,className:"flex-grow flex flex-col min-h-0",children:[(0,l.jsxs)("div",{className:"flex-shrink-0 mb-6 p-4 border rounded-lg bg-gray-50 flex flex-col gap-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("p",{className:"text-sm font-medium text-gray-700",children:["Context: ",y?"Data Preparation":"Dashboard"]}),y?(0,l.jsxs)("p",{className:"text-sm font-medium text-gray-700",children:["Selected File: ",(0,l.jsx)("span",{className:"font-semibold text-blue-600",children:m?m.split("/").pop():"None"})]}):(0,l.jsxs)("p",{className:"text-sm font-medium text-gray-700",children:["Well: ",t.join(", ")||"N/A"," / Intervals: ",a.length," selected"]})]}),(0,l.jsxs)("div",{className:"flex justify-end gap-2 mt-4 pt-4 border-t",children:[(0,l.jsx)("button",{type:"button",onClick:()=>u.back(),className:"px-6 py-2 rounded-md text-gray-800 bg-gray-200 hover:bg-gray-300 font-semibold",children:"Cancel"}),(0,l.jsx)("button",{type:"submit",className:"px-6 py-2 rounded-md text-white font-semibold bg-blue-600 hover:bg-blue-700",disabled:b,children:b?(0,l.jsx)(o.A,{className:"animate-spin"}):"Start"})]})]}),(0,l.jsx)("h3",{className:"text-lg font-semibold mb-2 flex-shrink-0",children:"Parameters"}),(0,l.jsx)("div",{className:"flex-grow min-h-0 border border-gray-300 rounded-lg",children:(0,l.jsx)("div",{className:"overflow-auto h-full",children:(0,l.jsxs)("table",{className:"min-w-full text-sm table-auto",children:[(0,l.jsx)("thead",{className:"bg-gray-200 sticky top-0 z-10",children:(0,l.jsx)("tr",{children:["#","Location","Mode","Comment","Unit","Name","Value"].map(e=>(0,l.jsx)("th",{className:"px-3 py-2 text-left font-semibold text-gray-700 border-b border-r",children:e},e))})}),(0,l.jsx)("tbody",{className:"bg-white",children:p.map(e=>{var t,a;return"DEPTH_ABOVE"===e.name&&"DEPTH_ABOVE"!==v&&"CUSTOM_TRIM"!==v||"DEPTH_BELOW"===e.name&&"DEPTH_BELOW"!==v&&"CUSTOM_TRIM"!==v?null:(0,l.jsxs)("tr",{className:"border-b ".concat(e.isEnabled?"":"bg-gray-100 text-gray-400"),children:[(0,l.jsx)("td",{className:"px-3 py-2 border-r text-center ".concat(j(e.location,e.mode)),children:e.id}),(0,l.jsx)("td",{className:"px-3 py-2 border-r whitespace-nowrap ".concat(j(e.location,e.mode)),children:e.location}),(0,l.jsx)("td",{className:"px-3 py-2 border-r whitespace-nowrap ".concat(j(e.location,e.mode)),children:e.mode}),(0,l.jsx)("td",{className:"px-3 py-2 border-r max-w-xs whitespace-normal ".concat(j(e.location,e.mode)),children:e.comment}),(0,l.jsx)("td",{className:"px-3 py-2 border-r whitespace-nowrap ".concat(j(e.location,e.mode)),children:e.unit}),(0,l.jsx)("td",{className:"px-3 py-2 border-r font-semibold whitespace-nowrap ".concat(j(e.location,e.mode)),children:e.name}),(0,l.jsx)("td",{className:"px-3 py-2 border-r bg-white text-black",children:"TRIM_MODE"===e.name?(0,l.jsxs)("select",{value:String(null!=(t=e.values.default)?t:""),onChange:t=>w(e.id,t.target.value),className:"w-full min-w-[100px] p-1 bg-white",children:[(0,l.jsx)("option",{value:"DEPTH_ABOVE",children:"DEPTH_ABOVE"}),(0,l.jsx)("option",{value:"DEPTH_BELOW",children:"DEPTH_BELOW"}),(0,l.jsx)("option",{value:"CUSTOM_TRIM",children:"CUSTOM_TRIM"})]}):(0,l.jsx)("input",{type:"number",value:null!=(a=e.values.default)?a:"",onChange:t=>w(e.id,t.target.value),className:"w-full min-w-[100px] p-1 bg-white"})})]},e.id)})})]})})})]})]})}},6252:(e,t,a)=>{a.d(t,{A:()=>u});var l=a(5155),s=a(2115),r=a(5028),n=a(1154),o=a(1243),i=a(4213),c=a(9509);let d=(0,r.default)(()=>Promise.all([a.e(840),a.e(134),a.e(133)]).then(a.bind(a,1514)),{loadableGenerated:{webpack:()=>[1514]},ssr:!1}),m=["BNG-56","BNG-58","BNG-59"];function u(){let[e,t]=(0,s.useState)(null),[a,r]=(0,s.useState)(!0),[u,h]=(0,s.useState)(null),[p,g]=(0,s.useState)(m[0]),b=c.env.NEXT_PUBLIC_API_URL,f="".concat(b,"/api/run-depth-matching"),x=(0,s.useCallback)(async e=>{r(!0),h(null),t(null);try{let a=await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({well_name:e})});if(!a.ok){let e=await a.json();throw Error(e.error||"Terjadi kesalahan di server")}let l=await a.json(),s=JSON.parse(l);t(s)}catch(e){h(e instanceof Error?e.message:"Terjadi kesalahan tidak dikenal")}finally{r(!1)}},[f]);return(0,s.useEffect)(()=>{x(p)},[p,x]),(0,l.jsxs)("div",{className:"flex flex-col p-4 bg-gray-50",children:[(0,l.jsxs)("div",{className:"mb-4 p-3 border rounded-lg bg-white shadow-sm",children:[(0,l.jsxs)("div",{className:"flex items-center mb-2",children:[(0,l.jsx)(i.A,{className:"h-5 w-5 mr-2 text-gray-600"}),(0,l.jsx)("h3",{className:"text-md font-semibold text-gray-800",children:"Pilih Sumur (Well)"})]}),(0,l.jsx)("div",{className:"flex space-x-2",children:m.map(e=>(0,l.jsx)("button",{onClick:()=>g(e),disabled:a,className:"\n                            px-4 py-2 text-sm font-medium border rounded-md transition-colors\n                            ".concat(p===e?"bg-blue-600 text-white border-blue-700 shadow-md":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100","\n                            disabled:bg-gray-200 disabled:cursor-not-allowed disabled:text-gray-400\n                        "),children:e},e))})]}),(0,l.jsx)("div",{className:"flex-grow min-h-0 border rounded-lg shadow-inner bg-white p-2",children:a?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center text-gray-500",children:[(0,l.jsx)(n.A,{className:"animate-spin h-12 w-12 text-blue-600"}),(0,l.jsxs)("p",{className:"mt-4 text-lg font-semibold",children:["Menjalankan Depth Matching untuk ",p,"..."]}),(0,l.jsx)("p",{className:"text-sm",children:"Proses ini mungkin memakan waktu beberapa saat."})]}):u?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center text-red-600 p-4",children:[(0,l.jsx)(o.A,{className:"h-12 w-12 mb-4"}),(0,l.jsx)("h3",{className:"text-lg font-bold",children:"Terjadi Kesalahan"}),(0,l.jsx)("p",{className:"text-sm mt-2 bg-red-50 p-3 rounded-md",children:u})]}):e?(0,l.jsx)(d,{data:e.data,layout:e.layout,style:{width:"100%",height:"100%"},config:{responsive:!0},useResizeHandler:!0}):null})]})}},6850:(e,t,a)=>{a.d(t,{A:()=>m});var l=a(5155),s=a(2115),r=a(5695),n=a(1154),o=a(2577),i=a(8335),c=a(9509);let d=()=>{let e=e=>({default:e}),t={SPLICEDEPTH:1520,GR_RUN1:"GR_CAL",GR_RUN2:"DGRCC",GR:"GR",NPHI_RUN1:"TNPH",NPHI_RUN2:"TNPL",NPHI:"NPHI",RHOB_RUN1:"RHOZ",RHOB_RUN2:"ALCDLC",RHOB:"RHOB",RT_RUN1:"RLA5",RT_RUN2:"R39PC",RT:"RT"};return[{id:1,location:"Constant",mode:"Input",comment:"Depth at which to splice the logs",unit:"m",name:"SPLICEDEPTH",isEnabled:!0},{id:2,location:"Log",mode:"Input",comment:"Gamma Ray Log from UPPER section (Run 1)",unit:"",name:"GR_RUN1",isEnabled:!0},{id:3,location:"Log",mode:"Input",comment:"Neutron Porosity Log from UPPER section (Run 1)",unit:"",name:"NPHI_RUN1",isEnabled:!0},{id:4,location:"Log",mode:"Input",comment:"Density Log from UPPER section (Run 1)",unit:"",name:"RHOB_RUN1",isEnabled:!0},{id:5,location:"Log",mode:"Input",comment:"Resistivity Log from UPPER section (Run 1)",unit:"",name:"RT_RUN1",isEnabled:!0},{id:6,location:"Log",mode:"Input",comment:"Gamma Ray Log from LOWER section (Run 2)",unit:"",name:"GR_RUN2",isEnabled:!0},{id:7,location:"Log",mode:"Input",comment:"Neutron Porosity Log from LOWER section (Run 2)",unit:"",name:"NPHI_RUN2",isEnabled:!0},{id:8,location:"Log",mode:"Input",comment:"Density Log from LOWER section (Run 2)",unit:"",name:"RHOB_RUN2",isEnabled:!0},{id:9,location:"Log",mode:"Input",comment:"Resistivity Log from LOWER section (Run 2)",unit:"",name:"RT_RUN2",isEnabled:!0},{id:10,location:"Log",mode:"Output",comment:"Spliced Gamma Ray Output Log",unit:"",name:"GR",isEnabled:!0},{id:11,location:"Log",mode:"Output",comment:"Spliced Neutron Porosity Output Log",unit:"",name:"NPHI",isEnabled:!0},{id:12,location:"Log",mode:"Output",comment:"Spliced Density Output Log",unit:"",name:"RHOB",isEnabled:!0},{id:13,location:"Log",mode:"Output",comment:"Spliced Resistivity Output Log",unit:"",name:"RT",isEnabled:!0}].map(a=>({...a,values:e(t[a.name]||"")}))};function m(){let{selectedWells:e,wellColumns:t,setPlotFigure:a}=(0,o.M)(),m=(0,r.useRouter)(),[u,h]=(0,s.useState)([]),[p,g]=(0,s.useState)(!1),[b,f]=(0,s.useState)([]),[x,y]=(0,s.useState)(""),[w,N]=(0,s.useState)(""),[j,v]=(0,s.useState)([]),[_,E]=(0,s.useState)([]),[S,P]=(0,s.useState)(!1),[R,C]=(0,s.useState)(!1),[k,L]=(0,s.useState)(""),[T,O]=(0,s.useState)(""),{fieldName:I,structureName:A,wellFolder:U}=(0,i.m)(),D=Object.keys(t).length>0?Object.keys(t):e,M=e=>"data/structures/".concat(I,"/").concat(A,"/").concat(U,"/").concat(e),H=async e=>{if(0===e.length)return{};P(!0);let t=c.env.NEXT_PUBLIC_API_URL,a=e.map(e=>M(e));try{let e=await fetch("".concat(t,"/api/get-well-columns"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({wells:a})});if(!e.ok)throw Error("Failed to fetch well columns");return await e.json()}catch(e){return console.error("Error fetching well columns:",e),{}}finally{P(!1)}},B=e=>{let t=["GR","NPHI","RHOB","RT","GR_CAL","TNPH","RHOZ","RLA5","DGRCC","TNPL","ALCDLC","R39PC"];if(e.includes("_RUN1"))return j.length>0?j:t;{if(e.includes("_RUN2"))return _.length>0?_:t;let a=[...new Set([...j,..._])];return a.length>0?a:t}};(0,s.useEffect)(()=>{h(d())},[]),(0,s.useEffect)(()=>{x||w||!(D.length>=2)?x||1!==D.length||y(D[0]):(y(D[0]),N(D[1]))},[D,D.length,x,w]),(0,s.useEffect)(()=>{x?H([x]).then(e=>{let t="".concat(x,".csv");e&&e[t]?(console.log('[RUN 1] SUCCESS: Columns found for key "'.concat(t,'"')),v(e[t])):(console.error('[RUN 1] FAILED: Key "'.concat(t,'" not found in API response.'),e),v([]))}):v([])},[x]),(0,s.useEffect)(()=>{w?H([w]).then(e=>{let t="".concat(w,".csv");e&&e[t]?(console.log('[RUN 2] SUCCESS: Columns found for key "'.concat(t,'"')),E(e[t])):(console.error('[RUN 2] FAILED: Key "'.concat(t,'" not found in API response.'),e),E([]))}):E([])},[w]),(0,s.useEffect)(()=>{let e=[];x?(e.push(x),L(M(x))):L(""),w&&w!==x?(e.push(w),O(M(w))):O(""),f(e)},[x,w]);let F=(e,t)=>{h(a=>a.map(a=>a.id!==e?a:{...a,values:{default:t}}))},W=async e=>{e.preventDefault(),g(!0);let t={params:u.filter(e=>e.isEnabled).reduce((e,t)=>{let a=t.values.default;return e[t.name]=a,e},{}),selected_wells:b,run1_well:x,run2_well:w,run1_file_path:k,run2_file_path:T};console.log("Payload yang dikirim ke backend:",t);let l=c.env.NEXT_PUBLIC_API_URL;try{let e=await fetch("".concat(l,"/api/run-splicing"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){let t=await e.json();throw Error(t.error||"Server error")}let s=await e.json();console.log("Splicing result:",s),C(!0);try{let e,t=await fetch("".concat(l,"/api/get-splicing-plot"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_path:s.output_file_path||"sample_data/structures/ADERA_Field/benuang/BNG-057.csv"})});if(!t.ok)throw Error("Failed to generate plot");let r=await t.json();console.log("Plot data received:",r);try{if((e="string"==typeof r?JSON.parse(r):r)&&"object"==typeof e&&(e.data||e.layout))a({data:e.data||[],layout:e.layout||{}}),console.log("Splicing plot data updated in dashboard context");else throw console.error("Invalid plot data structure received"),Error("Invalid plot data structure")}catch(e){throw console.error("Failed to parse plot data:",e),Error("Could not parse plot data")}alert(s.message||"Splicing/Merging completed successfully! Plot has been generated.")}catch(e){console.error("Plot generation error:",e),alert("Splicing completed successfully, but plot generation failed: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{C(!1)}m.push("/dashboard")}catch(e){alert("Error: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{g(!1)}},G=(e,t)=>{switch(e){case"Parameter":return"bg-orange-600";case"Constant":return"Input"===t?"bg-yellow-300":"bg-yellow-100";case"Log":return"Input"===t?"bg-cyan-400":"bg-cyan-200";case"Output":return"bg-yellow-600";case"Interval":return"bg-green-400";default:return"bg-white"}};return(0,l.jsxs)("div",{className:"p-4 md:p-6 h-full flex flex-col bg-white rounded-lg shadow-md",children:[(0,l.jsx)("h2",{className:"text-xl font-bold mb-4 text-gray-800 flex-shrink-0",children:"Splicing / Merging Logs"}),D.length<2?(0,l.jsx)("div",{className:"flex-grow flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center p-8 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"Insufficient Wells"}),(0,l.jsxs)("p",{className:"text-yellow-700 mb-4",children:["Splicing requires at least 2 wells to be selected. Currently available: ",D.length]}),(0,l.jsx)("p",{className:"text-sm text-yellow-600",children:"Please select more wells from the sidebar or ensure well data is loaded."}),(0,l.jsx)("button",{onClick:()=>m.back(),className:"mt-4 px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700",children:"Go Back"})]})}):(0,l.jsxs)("form",{onSubmit:W,className:"flex-grow flex flex-col min-h-0",children:[(0,l.jsxs)("div",{className:"flex-shrink-0 mb-6 p-4 border rounded-lg bg-gray-50",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Run 1 Well (Upper Section):"}),(0,l.jsxs)("select",{value:x,onChange:e=>y(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[(0,l.jsx)("option",{value:"",children:"Select Run 1 Well..."}),D.map(e=>(0,l.jsx)("option",{value:e,children:e},e))]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Run 2 Well (Lower Section):"}),(0,l.jsxs)("select",{value:w,onChange:e=>N(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[(0,l.jsx)("option",{value:"",children:"Select Run 2 Well..."}),D.filter(e=>e!==x).map(e=>(0,l.jsx)("option",{value:e,children:e},e))]})]})]}),(0,l.jsxs)("div",{className:"mb-4",children:[b.length<2&&(0,l.jsx)("p",{className:"text-xs text-red-500 mt-1",children:"Please select both Run 1 and Run 2 wells for splicing"}),S&&(0,l.jsxs)("p",{className:"text-xs text-blue-500 mt-1 flex items-center gap-1",children:[(0,l.jsx)(n.A,{className:"w-3 h-3 animate-spin"}),"Loading well columns..."]}),R&&(0,l.jsxs)("p",{className:"text-xs text-green-500 mt-1 flex items-center gap-1",children:[(0,l.jsx)(n.A,{className:"w-3 h-3 animate-spin"}),"Generating splicing plot..."]})]}),(0,l.jsxs)("div",{className:"flex justify-end gap-2 mt-4 pt-4 border-t",children:[(0,l.jsx)("button",{type:"button",onClick:()=>m.back(),className:"px-6 py-2 rounded-md text-gray-800 bg-gray-200 hover:bg-gray-300 font-semibold",children:"Cancel"}),(0,l.jsx)("button",{type:"submit",className:"px-6 py-2 rounded-md text-white font-semibold bg-blue-600 hover:bg-blue-700 flex items-center justify-center disabled:bg-gray-400 disabled:cursor-not-allowed",disabled:p||R||b.length<2,children:p?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.A,{className:"animate-spin mr-2"}),"Processing..."]}):R?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.A,{className:"animate-spin mr-2"}),"Generating Plot..."]}):"Start Splicing"})]})]}),(0,l.jsx)("h3",{className:"text-lg font-semibold mb-2 flex-shrink-0",children:"Parameters"}),(0,l.jsx)("div",{className:"flex-grow min-h-0 border border-gray-300 rounded-lg",children:(0,l.jsx)("div",{className:"overflow-auto h-full",children:(0,l.jsxs)("table",{className:"min-w-full text-sm table-auto",children:[(0,l.jsx)("thead",{className:"bg-gray-200 sticky top-0 z-10",children:(0,l.jsx)("tr",{children:["#","Location","Mode","Comment","Name","Value"].map(e=>(0,l.jsx)("th",{className:"px-3 py-2 text-left font-semibold text-gray-700 border-b border-r border-gray-300 whitespace-nowrap",children:e},e))})}),(0,l.jsx)("tbody",{className:"bg-white",children:u.map(e=>{var t,a;return(0,l.jsxs)("tr",{className:"border-b border-gray-200 ".concat(G(e.location,e.mode)),children:[(0,l.jsx)("td",{className:"px-3 py-2 border-r text-center text-sm",children:e.id}),(0,l.jsx)("td",{className:"px-3 py-2 border-r whitespace-nowrap text-sm",children:e.location}),(0,l.jsx)("td",{className:"px-3 py-2 border-r whitespace-nowrap text-sm",children:e.mode}),(0,l.jsx)("td",{className:"px-3 py-2 border-r whitespace-normal max-w-xs text-sm",children:e.comment}),(0,l.jsx)("td",{className:"px-3 py-2 border-r font-semibold whitespace-nowrap text-sm",children:e.name}),(0,l.jsx)("td",{className:"px-3 py-2 border-r bg-white text-black",children:"Log"===e.location?(0,l.jsx)("select",{value:null!=(t=e.values.default)?t:"",onChange:t=>F(e.id,t.target.value),className:"w-full p-1 bg-white text-black",disabled:S,children:S?(0,l.jsx)("option",{value:"",children:"Loading columns..."}):B(e.name).map(e=>(0,l.jsx)("option",{value:e,children:e},e))}):(0,l.jsx)("input",{type:"text",value:null!=(a=e.values.default)?a:"",onChange:t=>F(e.id,t.target.value),className:"w-full min-w-[100px] p-1 bg-white text-black"})})]},e.id)})})]})})})]})]})}},8335:(e,t,a)=>{a.d(t,{m:()=>r});var l=a(5453),s=a(6786);let r=(0,l.v)()((0,s.Zr)((e,t)=>({stagedStructure:null,qcResults:null,handledFiles:[],normalizationResults:{},selectedWell:"",selectedIntervals:[],plotData:[],plotLayout:{},isLoadingPlot:!0,plotError:null,vshParams:{gr_ma:30,gr_sh:120},vshDNParams:{rhob_ma:2.645,rhob_sh:2.61,nphi_ma:-.02,nphi_sh:.398,prcnt_qz:5,prcnt_wtr:5},wellsDir:"data/structures/adera/benuang",fieldName:"adera",structureName:"benuang",wellFolder:"BNG-057",setWellsDir:t=>{console.log("Updating wellsDir to: ".concat(t)),e({wellsDir:t})},setStructure:(t,a,l)=>{let s="data/structures/".concat(t.toLowerCase(),"/").concat(a.toLowerCase());console.log("Updating structure settings:\n          fieldName: ".concat(t.toLowerCase(),"\n          structureName: ").concat(a.toLowerCase(),"\n          wellFolder: ").concat(l.toLowerCase(),"\n          wellsDir: ").concat(s)),e({fieldName:t.toLowerCase(),structureName:a.toLowerCase(),wellFolder:l.toLowerCase(),wellsDir:s})},setStagedStructure:t=>e({stagedStructure:t}),setQcResults:t=>e({qcResults:t}),addHandledFile:t=>e(e=>({handledFiles:[...e.handledFiles,t]})),addNormalizationResult:(t,a)=>e(e=>({normalizationResults:{...e.normalizationResults,[t]:a}})),clearQcResults:()=>e({qcResults:null,handledFiles:[]}),clearNormalizationResults:()=>e({normalizationResults:{}}),clearAllData:()=>e({stagedStructure:null,qcResults:null,handledFiles:[],normalizationResults:{},vshParams:{gr_ma:30,gr_sh:120},vshDNParams:{rhob_ma:2.645,rhob_sh:2.61,nphi_ma:-.02,nphi_sh:.398,prcnt_qz:5,prcnt_wtr:5}}),setSelectedWell:a=>{e({selectedWell:a}),t().fetchPlotData(a)},toggleInterval:t=>e(e=>({selectedIntervals:e.selectedIntervals.includes(t)?e.selectedIntervals.filter(e=>e!==t):[...e.selectedIntervals,t]})),setVshParams:t=>e({vshParams:t}),setVshDNParams:t=>e({vshDNParams:t}),fetchPlotData:async e=>{}}),{name:"app-data-storage",partialize:e=>({selectedWell:e.selectedWell,selectedIntervals:e.selectedIntervals,vshParams:e.vshParams,vshDNParams:e.vshDNParams}),storage:(0,s.KU)(()=>localStorage)}))},9521:(e,t,a)=>{a.d(t,{A:()=>m});var l=a(5155),s=a(2115),r=a(5695),n=a(2577),o=a(9183),i=a(1154),c=a(8335),d=a(9509);function m(){let{selectedWells:e,wellColumns:t,selectedFilePath:a}=(0,n.M)(),m=(0,r.useRouter)(),u=(0,r.usePathname)(),[h,p]=(0,s.useState)([]),[g,b]=(0,s.useState)(3),[f,x]=(0,s.useState)(!1),[y,w]=(0,s.useState)(!1),[N,j]=(0,s.useState)([]),v=u.startsWith("/data-prep"),{fieldName:_,structureName:E,wellFolder:S,wellsDir:P}=(0,c.m)();(0,s.useEffect)(()=>{if(!v||!a)return void j([]);let e=!1;return(async()=>{let t=d.env.NEXT_PUBLIC_API_URL;try{let a=await fetch("".concat(t,"/api/get-well-columns"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({full_path:P})});if(!a.ok){let e=await a.text();throw Error("Gagal mengambil kolom: ".concat(a.status," ").concat(e))}let l=await a.json(),s=[];if(Array.isArray(l))s=l;else if(l&&"object"==typeof l){let e=Object.values(l).filter(e=>Array.isArray(e));s=e.length>0?Array.from(new Set(e.flat())):Array.isArray(l.combined)?l.combined:[]}e||j(s)}catch(t){console.error("Error fetching columns:",t),e||j([])}})(),()=>{e=!0}},[v,P]);let R=(0,s.useMemo)(()=>{let a=new Set(["DEPTH","STRUKTUR","WELL_NAME","CALI","SP","MARKER","ZONE","MISSING_FLAG"]),l=[];if(v)l=Array.isArray(N)?N:[];else{if(!e||0===e.length)return[];let a=new Set;e.forEach(e=>{(t&&t[e]||[]).forEach(e=>{e&&a.add(e)})}),l=Array.from(a)}return l.filter(e=>e&&!a.has(e.toUpperCase())).sort((e,t)=>e.localeCompare(t)).map(e=>({label:e,value:e}))},[v,N,e,t]),C=()=>v?P&&0!==P.length?{file_paths:P}:(alert("Please select at least one file from the Wells Browser sidebar."),null):e&&0!==e.length?{selected_wells:e}:(alert("Please select a well from the dashboard sidebar."),null),k=async()=>{let e=C();if(!e||0===h.length)return void alert("Please select at least one log to flag.");x(!0);try{let t=await fetch("".concat(d.env.NEXT_PUBLIC_API_URL,"/api/flag-missing"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,logs_to_check:h,full_path:P})}),a=await t.json();if(!t.ok)throw Error((null==a?void 0:a.error)||"Failed to run flagging process.");alert("✅ ".concat(a.message))}catch(e){alert("❌ ".concat(e instanceof Error?e.message:"Unknown error"))}finally{x(!1)}},L=async()=>{let e=C();if(!e||0===h.length)return void alert("Please select at least one log to fill.");w(!0);try{let t=await fetch("".concat(d.env.NEXT_PUBLIC_API_URL,"/api/fill-flagged-missing"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,logs_to_fill:h,max_consecutive_nan:g,full_path:P})}),a=await t.json();if(!t.ok)throw Error((null==a?void 0:a.error)||"Failed to run filling process.");alert("✅ ".concat(a.message)),m.push(v?"/data-prep":"/dashboard")}catch(e){alert("❌ ".concat(e instanceof Error?e.message:"Unknown error"))}finally{w(!1)}},T=e=>"Constant"===e?"bg-yellow-300 text-gray-800":"Log"===e?"bg-cyan-400 text-gray-800":"bg-white";return(0,l.jsxs)("div",{className:"p-6 bg-white rounded-lg shadow-md max-w-4xl mx-auto",children:[(0,l.jsx)("h2",{className:"text-xl font-bold mb-4 text-gray-800",children:"Fill Missing Values (Two Stages)"}),(0,l.jsxs)("div",{className:"flex-shrink-0 mb-6 p-4 border rounded-lg bg-gray-50",children:[(0,l.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-2",children:v?"Context: Data Preparation (".concat(P.length," files selected)"):"Context: Dashboard (".concat((e||[]).length," wells selected)")}),(0,l.jsxs)("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[(0,l.jsx)("button",{type:"button",onClick:()=>m.back(),className:"px-4 py-2 rounded-md text-gray-800 bg-gray-200 hover:bg-gray-300 font-semibold",children:"Cancel"}),(0,l.jsx)("button",{type:"button",onClick:k,className:"px-4 py-2 rounded-md text-white font-semibold bg-orange-500 hover:bg-orange-600 flex items-center justify-center min-w-[150px]",disabled:f||y,children:f?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.A,{className:"animate-spin w-4 h-4 mr-2"}),"Flagging..."]}):"Stage 1: Flag Missing"}),(0,l.jsx)("button",{type:"button",onClick:L,className:"px-4 py-2 rounded-md text-white font-semibold bg-blue-600 hover:bg-blue-700 flex items-center justify-center min-w-[150px]",disabled:y||f,children:y?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.A,{className:"animate-spin w-4 h-4 mr-2"}),"Filling..."]}):"Stage 2: Fill Flagged"})]})]}),(0,l.jsx)("h3",{className:"text-lg font-semibold mb-2 flex-shrink-0",children:"Parameters"}),(0,l.jsx)("div",{className:"flex-grow min-h-0 border border-gray-300 rounded-lg overflow-auto",children:(0,l.jsxs)("table",{className:"min-w-full text-sm table-auto",children:[(0,l.jsx)("thead",{className:"bg-gray-200 sticky top-0 z-10",children:(0,l.jsx)("tr",{children:["#","Location","Comment","Name","Value"].map(e=>(0,l.jsx)("th",{className:"px-3 py-2 text-left font-semibold text-gray-700 border-b border-r",children:e},e))})}),(0,l.jsxs)("tbody",{className:"bg-white",children:[(0,l.jsxs)("tr",{className:"border-b",children:[(0,l.jsx)("td",{className:"px-3 py-2 border-r text-center ".concat(T("Log")),children:"1"}),(0,l.jsx)("td",{className:"px-3 py-2 border-r ".concat(T("Log")),children:"Log"}),(0,l.jsx)("td",{className:"px-3 py-2 border-r ".concat(T("Log")),children:"Select logs to be flagged and filled"}),(0,l.jsx)("td",{className:"px-3 py-2 border-r font-semibold ".concat(T("Log")),children:"LOGS"}),(0,l.jsx)("td",{className:"px-3 py-2 bg-white text-black",children:(0,l.jsx)(o.Ay,{isMulti:!0,options:R,value:R.filter(e=>h.includes(e.value)),onChange:e=>p(Array.isArray(e)?e.map(e=>e.value):[]),className:"min-w-[200px] text-sm text-black",classNamePrefix:"react-select",menuPortalTarget:document.body,styles:{menuPortal:e=>({...e,zIndex:9999})},placeholder:R.length?"Select logs...":"No logs available",isDisabled:0===R.length})})]}),(0,l.jsxs)("tr",{className:"border-b",children:[(0,l.jsx)("td",{className:"px-3 py-2 border-r text-center ".concat(T("Constant")),children:"2"}),(0,l.jsx)("td",{className:"px-3 py-2 border-r ".concat(T("Constant")),children:"Constant"}),(0,l.jsx)("td",{className:"px-3 py-2 border-r ".concat(T("Constant")),children:"Max consecutive NaNs to fill (for Stage 2)"}),(0,l.jsx)("td",{className:"px-3 py-2 border-r font-semibold ".concat(T("Constant")),children:"MAX_CONSECUTIVE_NAN"}),(0,l.jsx)("td",{className:"px-3 py-2 bg-white text-black",children:(0,l.jsx)("input",{type:"number",value:g,onChange:e=>b(parseInt(e.target.value,10)||0),className:"w-full min-w-[100px] p-2 bg-white text-black border rounded"})})]})]})]})})]})}}}]);